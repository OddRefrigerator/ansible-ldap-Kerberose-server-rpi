include         /etc/ldap/schema/core.schema
include         /etc/ldap/schema/cosine.schema
include         /etc/ldap/schema/nis.schema
include         /etc/ldap/schema/inetorgperson.schema
include         /etc/ldap/schema/kerberos.schema

pidfile         /var/run/slapd/slapd.pid
argsfile        /var/run/slapd/slapd.args

#sasl-realm {{ krb5realm|upper() }}
#sasl-host {{ hostName }}

authz-policy from
authz-regexp
  uid=([^,]*),cn=[^,]*,cn=auth
  uid=$1,ou=users,dc=home,dc=com

authz-regexp
  uid=([^,]*),cn=auth
  uid=$1,ou=users,dc=home,dc=com

access to attrs=userPassword,shadowLastChange
        by dn="cn=krb5-admin,{{ ldapBaseDN }}" write
        by anonymous auth
        by self write
        by * none

access to dn.base="" by * read

access to *
        by dn="cn=krb5-admin,{{ ldapBaseDN }}" write
        by * read

password-hash {SSHA}
loglevel        16384
modulepath	/usr/lib/ldap
moduleload	back_mdb
sizelimit 500
tool-threads 1

defaultsearchbase "{{ ldapBaseDN }}"

backend         mdb
database        mdb    
suffix          "{{ ldapBaseDN }}" 
directory       "/var/lib/ldap"

index           objectClass eq
lastmod         on
checkpoint      512 30




